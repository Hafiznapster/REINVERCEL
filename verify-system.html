<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Verification</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîç Solar Quote System Verification</h1>
    
    <div class="status info">
        <h3>üìä System Status Check</h3>
        <p>This page verifies that your solar quote system is working correctly.</p>
    </div>

    <div class="status success">
        <h3>‚úÖ What Should Be Working:</h3>
        <ul>
            <li><strong>Local Storage:</strong> All quotes saved in browser</li>
            <li><strong>OpenSolar API:</strong> Direct submission via AJAX</li>
            <li><strong>Admin Dashboard:</strong> View quotes at /#/admin/quotes</li>
            <li><strong>CSV Export:</strong> Download quotes for manual processing</li>
        </ul>
    </div>

    <div class="status warning">
        <h3>‚ö†Ô∏è Expected Failures (Normal on S3):</h3>
        <ul>
            <li><strong>Serverless Proxy:</strong> 405 Method Not Allowed (expected)</li>
            <li><strong>PHP Proxy:</strong> 405 Method Not Allowed (expected)</li>
        </ul>
        <p>These failures are normal because AWS S3 static hosting can't run server-side code.</p>
    </div>

    <div class="status info">
        <h3>üß™ Quick Tests:</h3>
        <button onclick="checkLocalStorage()">Check Local Storage</button>
        <button onclick="testOpenSolarAPI()">Test OpenSolar API</button>
        <button onclick="viewAdminDashboard()">Open Admin Dashboard</button>
        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script>
        function checkLocalStorage() {
            const quotes = JSON.parse(localStorage.getItem('solarQuotes') || '[]');
            const results = document.getElementById('results');
            
            if (quotes.length > 0) {
                results.innerHTML = `
                    <div class="status success">
                        <h4>‚úÖ Local Storage Working</h4>
                        <p>Found ${quotes.length} stored quotes:</p>
                        <ul>
                            ${quotes.slice(-3).map(q => `
                                <li>${q.firstName} ${q.lastName} - ${new Date(q.timestamp).toLocaleDateString()} 
                                    ${q.apiSubmitted ? '<span style="color: green;">[API Sent]</span>' : '<span style="color: orange;">[Local Only]</span>'}
                                </li>
                            `).join('')}
                        </ul>
                        ${quotes.length > 3 ? `<p>...and ${quotes.length - 3} more</p>` : ''}
                    </div>
                `;
            } else {
                results.innerHTML = `
                    <div class="status warning">
                        <h4>‚ö†Ô∏è No Quotes Found</h4>
                        <p>No quotes in local storage yet. Submit a quote first!</p>
                    </div>
                `;
            }
        }

        function testOpenSolarAPI() {
            const results = document.getElementById('results');
            results.innerHTML = `
                <div class="status info">
                    <h4>üß™ Testing OpenSolar API...</h4>
                    <p>Sending test data to OpenSolar API...</p>
                </div>
            `;

            // Test with form data
            const formData = new FormData();
            formData.append('first_name', 'Test');
            formData.append('last_name', 'User');
            formData.append('email', 'test@example.com');
            formData.append('phone', '555-123-4567');
            formData.append('address', '123 Test Street, Test City, TS 12345');
            formData.append('notes', 'System verification test');
            formData.append('roof_type', '6');
            formData.append('number_of_phases', '1');
            formData.append('widget_id', 'ca8ae2d8109747b496bf67a411ac789b');

            fetch('https://api.opensolar.com/api/lead_capture_widget/ca8ae2d8109747b496bf67a411ac789b', {
                method: 'POST',
                body: formData,
                mode: 'no-cors'
            }).then(() => {
                results.innerHTML = `
                    <div class="status success">
                        <h4>‚úÖ OpenSolar API Test Sent</h4>
                        <p>Test data sent to OpenSolar API successfully!</p>
                        <p><strong>Note:</strong> Due to CORS restrictions, we can't see the response, but the data was sent.</p>
                        <p>Check your OpenSolar dashboard for the test lead.</p>
                    </div>
                `;
            }).catch(error => {
                results.innerHTML = `
                    <div class="status warning">
                        <h4>‚ö†Ô∏è API Test Failed</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            });
        }

        function viewAdminDashboard() {
            window.open('/#/admin/quotes', '_blank');
        }

        // Auto-check on page load
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>